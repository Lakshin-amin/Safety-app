<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <title>SOS History</title>
</head>

<body class="p-6 bg-slate-50">

  <a href="../index.html" class="text-blue-600">‚Üê Back</a>
  <h1 class="text-2xl font-bold mt-4 mb-6">SOS Alert History</h1>

  <div id="alertList" class="space-y-4"></div>

  <script type="module">
    import { auth, db } from "../src/firebase-init.js";
    import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    async function loadAlerts() {
      const user = auth.currentUser;

      if (!user) {
        document.getElementById("alertList").innerHTML = 
          "<p class='text-red-500'>Please login first.</p>";
        return;
      }

      const q = query(collection(db, "alerts"), where("uid", "==", user.uid));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        document.getElementById("alertList").innerHTML =
          "<p class='text-slate-600'>No alerts found.</p>";
        return;
      }

      snapshot.forEach(doc => {
        const a = doc.data();
        const div = document.createElement("div");
        div.className = "bg-white p-4 shadow rounded-lg";

        div.innerHTML = `
          <p><b>Time:</b> ${new Date(a.timestamp).toLocaleString()}</p>
          <p><b>Location:</b> ${a.lat}, ${a.lng}</p>
          <a class="text-blue-600" target="_blank"
             href="https://www.google.com/maps?q=${a.lat},${a.lng}">
            Open in Google Maps
          </a>
        `;

        document.getElementById("alertList").appendChild(div);
      });
    }

    setTimeout(loadAlerts, 1500);
  </script>
</body>
</html>
